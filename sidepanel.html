<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ahamkara Wishes</title>
  <link rel="stylesheet" href="sidepanel.css" />
  <link rel="stylesheet" href="weapon-sidepanel.css" />
  <!-- Menu-specific styles for Bungie auth UI -->
  <link rel="stylesheet" href="menu-sidepanel.css" />
</head>

<body>
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Oh User Mine...</div>
    <div class="loading-status"></div>
  </div>
  <div class="app-container">
    <header>
      <div class="logo-area">
        <h1 id="panel-reset-trigger">AHAMKARA WISHES</h1>
        <span class="subtitle">Wishlist manager</span>
      </div>

      <div class="tab-switcher">
        <button id="tab-weapons" class="tab-btn">WEAPONS</button>
        <button id="tab-menu" class="tab-btn menu-btn active" title="Menu" aria-label="Menu">
          <span class="hamburger-icon" aria-hidden="true">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:block;margin:auto;">
              <rect y="4" width="22" height="2.5" rx="1.25" fill="currentColor"/>
              <rect y="9.25" width="22" height="2.5" rx="1.25" fill="currentColor"/>
              <rect y="14.5" width="22" height="2.5" rx="1.25" fill="currentColor"/>
            </svg>
          </span>
        </button>
        <button id="tab-armor" class="tab-btn">ARMOR</button>
    <!-- Maintenance cover: shown when Destiny API is down for maintenance -->
    <div id="maintenance-cover" style="display:none">
      <div class="cover-content">
        <h1>Destiny is down for maintenance</h1>
        <p>Please try again later.</p>
        <button id="reset-cache-btn">Reset Cache & Reload</button>
        <button id="dismiss-maintenance-btn">Use Old Cache Anyway</button>
      </div>
    </div>

      </div>
    </header>

    <div id="view-weapons" class="content-view">
      <!-- WEAPON VIEW STAGE - Dual-pane slider (craft â†” list) -->
      <div id="weapon-view-stage" class="weapon-view-stage">
        <div class="weapon-view-slider show-w-craft">
          
          <!-- PANE 1: CRAFT/BUILD VIEW -->
          <div id="pane-w-craft" class="weapon-pane">
            <!-- Step 1: SEARCH WEAPON -->
            <div class="step-container">
              <div class="step-label">1. SEARCH WEAPON</div>
              <div class="weapon-search-row">
                <input type="text" id="w-search-input" class="search-input" placeholder="Search weapon name...">
                <div class="weapon-search-actions">
                  <button id="w-history-toggle" class="weapon-search-btn" type="button">HISTORY</button>
                  <button id="w-history-clear" class="weapon-search-btn weapon-search-btn-clear" type="button">CLEAR</button>
                </div>
              </div>
              <div id="w-search-results"></div>
            </div>

            <!-- Selected Weapon Header (Initially Hidden) -->
            <div id="w-selected-header" class="selected-weapon-header hidden">
              <!-- Hero Banner Image with Overlaid Content -->
              <div class="w-hero-banner">
                <img id="w-selected-screenshot" src="" alt="Weapon Image" class="w-hero-image">
                
                <!-- New Overlay Container: Top Left -->
                <div class="w-hero-info-top-left">
                  <div style="display:flex;align-items:baseline;gap:6px;">
                    <div id="w-selected-name" class="w-hero-name"></div>
                    <div id="w-selected-hash" class="w-hero-hash" style="font-size:11px;color:#888;"></div>
                  </div>
                  <div id="w-selected-type" class="w-hero-type"></div>
                  
                  <div class="w-hero-property-group">
                    <div class="w-hero-label">DAMAGE TYPE</div>
                    <div id="w-selected-damage" class="w-hero-damage"></div>
                  </div>
                  
                  <div class="w-hero-property-group">
                    <div class="w-hero-label">AMMO TYPE</div>
                    <div id="w-selected-ammo" class="w-hero-ammo"></div>
                  </div>
                  
                  <div class="w-hero-property-group">
                    <div class="w-hero-label">DROPS FROM</div>
                    <div id="w-selected-activity" class="w-hero-activity"></div>
                  </div>
                </div>

                <!-- Flavor Text Overlay -->
                <div id="w-selected-flavor" class="w-flavor-overlay"></div>
              </div>
              
              <!-- Below Image: Properties + Drops From -->
              <div class="w-content-layout">
                <!-- Left Column -->
                <div class="w-left-column">
                  
                  <div class="w-property-stack">
                    <div class="w-property-item">
                      <div id="w-selected-frame" class="w-property-value"></div>
                    </div>
                  </div>
                </div>
              </div>

              <section class="stats-perks-section" id="w-stats-perks-section">
                <div class="stats-column">
                  <div class="stats-section-title">WEAPON STATS</div>
                  <div id="w-stats-table" class="stat-bars"></div>
                </div>
                <div class="perks-column">
                  <div class="perks-title-row">
                    <div class="perks-section-title">PERKS</div>
                    <button id="w-perk-enhanced-toggle" class="perk-enhanced-toggle" type="button" disabled>
                      ENHANCED
                    </button>
                  </div>
                  <div id="w-perk-slots" class="perk-slots"></div>
                </div>
              </section>
            </div>
          </div>

          <!-- PANE 2: LIST VIEW -->
          <div id="pane-w-list" class="weapon-pane">
            <div class="weapon-filters">
              <input type="text" id="w-list-search" placeholder="Search saved weapons...">
              <div class="filter-toggles">
                <button class="filter-toggle" data-filter="type">ALL TYPES</button>
                <button class="filter-toggle" data-filter="damage">ALL ELEMENTS</button>
                <button class="filter-toggle" data-filter="mode">ALL MODES</button>
                <button id="w-clear-filters" style="margin-left: auto;">CLEAR</button>
              </div>
            </div>
            <div id="w-weapon-list">
              <!-- Populated by weapon-ui.js when switching to list view -->
            </div>
            <div id="w-empty-state" style="text-align: center; padding: 40px 20px; color: #666; display: none;">
              No weapons saved yet.
            </div>
          </div>

        </div>

        <!-- BOTTOM NAV for pane switching -->
        <nav class="weapon-nav">
          <button id="nav-w-craft" class="nav-btn active">CRAFT</button>
          <button id="nav-w-list" class="nav-btn">LIST</button>
        </nav>
      </div>
    </div>

    <!-- MENU VIEW (sibling to weapons & armor) -->
    <div id="view-menu" class="content-view active-view">
      <!-- Top header: profile + login/logout -->
      <div id="menu-auth-header" class="menu-auth-header signed-out">
        <div class="menu-auth-inner">
          <img id="bungie-user-photo" class="bungie-user-photo" src="" alt=""/>
          <div class="menu-auth-info">
            <div id="bungie-user-name" class="bungie-user-name">Not signed in</div>
            <div id="bungie-auth-status" class="auth-status small">Not logged in</div>
          </div>
          <div class="menu-auth-actions">
            <button id="bungie-login-btn" class="auth-btn">Login</button>
            <button id="bungie-logout-btn" class="auth-btn secondary" style="display:none;">Logout</button>
          </div>
        </div>
      </div>

      <div class="menu-panel" style="margin:auto;text-align:center;padding:24px 12px;max-width:420px;">
        <h2 class="menu-title">Menu</h2>
        <div class="menu-help">
          <p style="color:#aaa;margin-top:12px;">Use the button above to connect your Bungie account for Destiny 2 features. Tokens are stored in extension storage only.</p>
        </div>
      </div>
    </div>

    <div id="view-armor" class="content-view">
      <div class="armor-view-stage">
        <div class="armor-view-slider show-craft" id="armor-slider">
          
          <div class="armor-internal-view" id="pane-craft">
            <div class="class-selector">
              <button class="class-btn active" data-class="0">TITAN</button>
              <button class="class-btn" data-class="2">WARLOCK</button>
              <button class="class-btn" data-class="1">HUNTER</button>
            </div>

            <div class="armor-search-container">
              <div class="step-label">1. SEARCH ARMOR (Set Name)</div>
              <input type="text" class="search-input" id="armor-query" placeholder="e.g. Iron, Artifice, Noble...">

              <div class="armor-grid" id="armor-grid">
                <div id="armor-set-name"></div>
                <div class="armor-box" data-slot="Head"><span class="slot-label">HEAD</span></div>
                <div class="armor-box" data-slot="Arms"><span class="slot-label">ARMS</span></div>
                <div class="armor-box" data-slot="Chest"><span class="slot-label">CHEST</span></div>
                <div class="armor-box" data-slot="Legs"><span class="slot-label">LEGS</span></div>
                <div class="armor-box" data-slot="Class"><span class="slot-label">CLASS</span></div>
                <div id="select-full-set-btn" class="select-full-set-btn hidden">SELECT FULL SET</div>
              </div>
            </div>

            <div class="step-container">
              <div class="step-label">2. CHOOSE ARCHETYPE</div>
              <div class="grid-2col" id="archetype-grid"></div>
            </div>

            <div class="step-container">
              <div class="step-label">3. CHOOSE SPARK</div>
              <div class="grid-3col" id="spark-grid"></div>
            </div>

            <div class="action-area" style="margin-top: 20px;">
              <div class="toggle-container pve" id="ui-mode-toggle">
                <div class="opt-pve">PvE</div>
                <div class="opt-pvp">PvP</div>
              </div>
              <button id="btn-create-armor" class="btn-primary" disabled>SELECT ARMOR PIECE FIRST</button>
            </div>

            <div class="cache-controls" style="text-align: center; margin-top: 20px;">
              <button id="clearCacheBtn" class="secondary-btn">Reset Manifest Cache</button>
            </div>
          </div>

          <div class="armor-internal-view" id="pane-list">
             <!-- FILTER SECTION (INSIDE PANE-LIST SO ONLY VISIBLE IN LIST VIEW) -->
             <div class="armor-filter-section">
               <div class="filter-search">
                 <input type="text" id="armor-name-search" class="filter-input" placeholder="Search armor names...">
                 <button id="filter-toggle-btn" class="filter-toggle-btn-icon" title="Toggle Filters">
                   <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                     <path d="M10,18h4v-2h-4V18z M3,6v2h18V6H3z M6,13h12v-2H6V13z"/>
                   </svg>
                 </button>
               </div>
               
               <div id="filter-controls" class="filter-controls">
                 <div class="filter-toggle-buttons">
                   <button id="filter-btn-archetype" class="filter-toggle-btn">ARCHETYPE</button>
                   <button id="filter-btn-class" class="filter-toggle-btn">CLASS</button>
                 </div>
                 
                 <div id="filter-buttons-container" class="filter-buttons-container"></div>
                 
                 <div class="filter-clear-buttons">
                   <button id="filter-clear" class="filter-clear-btn">Clear</button>
                   <button id="filter-clear-all" class="filter-clear-all-btn">Clear All</button>
                 </div>
               </div>
             </div>

             <div id="armor-list-container">
                <div class="empty-list-text">No Armor Wishes yet.</div>
             </div>
          </div>

        </div>
      </div>

      <div class="bottom-nav-container">
        <div class="bottom-nav-pill">
          <button id="nav-craft" class="nav-btn active">CRAFT</button>
          <button id="nav-list" class="nav-btn">LIST</button>
        </div>
      </div>

    </div>
  </div>

  <script src="weapon-stats-clarity-api.js"></script>
  <script src="weapon-stats-clarity-processor.js"></script>
  <script src="weapon-stats-clarity-service.js"></script>
  <script src="weapon-stats-api.js"></script>
  <script src="weapon-stats-processor.js"></script>
  <script src="weapon-stats-service.js"></script>
  <script src="weapon-tooltip-clarity.js"></script>
  <script src="destiny-manifest.js"></script>
  <script src="manager.js"></script>
  <script src="weapon-manager.js"></script>
  <script src="weapon-ui.js"></script>
  <script src="ui-creator.js"></script>
  <script src="bungie-auth.js"></script>
</body>
</html>